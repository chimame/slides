## Rails勉強会 #2

rito

2017/05/29

---

### この会の目的
- - -
- Railsの知識を少しでも深めて業務に役立てよう
- チームおよび職種の枠を超えた相談を気軽に行おう

次回以降はリクエストがあればリクエスト内容をやります :smile:

---

### 今回の内容
- - -
テストを書いた処理をちょっとしたテクニックで
リファクタリングしよう

---
### `calculate_loan_charge_from` をリファクタリングしましょう
- - -
以下のような方式でリファクタリング
- `calculate_loan_charge_from` は結局は「日数×料金」をする
- 「日数」と「料金」の算出は別メソッドに出す

修正してもテストが通ることを確認して下さいね :smiling_imp:

---
### リファクタリング後の `calculate_loan_charge_from` のテストはオーバースペックです
- - -
「日数」と「料金」は別メソッドの役割なので 
`calculate_loan_charge_from` の
条件( `context` )として必要ないはずです :umbrella:

 :point_up: 「日数」と「料金」が返す値で計算されていることを
 テストすればいいということです

---
### テストも直しましょう
以下の要領でテストを直して下さい。

- - -
- 「日数」の `context` は「日数」のメソッドのテストに移動でして下さい。
- 「料金」の `context` は「料金」のメソッドのテストに移動して下さい。

---
### `calculate_loan_charge_from` 本来が行うべくテストに直しましょう
`calculate_loan_charge_from` ってどんな役割だっけ？ :thinking:

---
### 「日数」と「料金」を擬似的に動作させる
擬似的に動作させるのをモックと言います
（細かく言うと色々あるのですが、この認識で大丈夫）
- - -
`calculate_loan_charge_from` は
「日数」と「料金」の掛け算のが役割です :bulb:

---
### モックの作り方
実際のモックの作成方法
- - -
このように書くと「日数計算のメソッド」は '3' という値を返す
```ruby
allow(book).to recevi(:cal_number_of_days).and_return(3)
```

---
### テストを修正しよう
モックを使ったテストに `calculate_loan_charge_from` に書き換えて下さい
- - -
モックのメリットは
- わざわざ実値を用意しなくてよい
- 本来行うべくテストだけを行うようにできる

---
### 本日はこれで終了です
 :clap: お疲れ様でした :clap:
