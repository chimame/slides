## Rails勉強会 #2

rito

2017/05/XX

---

### この会の目的
- - -
- Railsの知識を少しでも深めて業務に役立てよう
- チームおよび職種の枠を超えた相談を気軽に行おう

次回以降はリクエストがあればリクエスト内容をやります :smile:

---

### 今回の内容
- - -
テストを書いた処理をちょっとしたテクニックでリファクタリングしよう

---
### `calculate_loan_charge_from` をリファクタリングしましょう
- - -
以下のような感じでリファクタリング
- `calculate_loan_charge_from` は結局は「日数×料金」のをする
- 「日数」と「料金」の算出は別メソッドに出す

修正してもテストが通ることを確認して下さいね :smiling_imp:

---
### リファクタリング後の `calculate_loan_charge_from` のテストはオーバースペックです
- - -
「日数」と「料金」は別メソッドの役割なので `calculate_loan_charge_from` の条件( `context` )として必要ないはずです :umbrella:

 :point_up: 「日数」と「料金」が返す値で計算されていることをテストすればいいということです

---
### ということでモックを作成しよう
- - -
モックとは本物に変わって本物のように動くもの  
(くらいの認識でいいです)

---
### モックの作り方
- - -
このように書くと「日数計算のメソッドは」 '3' という値を返す
```ruby
allow(book).to recevi(:cal_number_of_days).and_return(3)
```
